
{{- if .Values.bootstrap.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  # This name must match the name used in the bootstrap job's volume mount.
  name: rucio-bootstrap-config
data:
  rucio.cfg: |
    [client]
    rucio_host = {{ .Values.rucio.server.host }}
    auth_host = {{ .Values.rucio.server.host }}
    # Uses userpass auth ONLY for this bootstrap job.
    auth_type = userpass
    username = {{ .Values.bootstrap.auth.username }}
    password = {{ .Values.bootstrap.auth.password }}
    # Performs actions as the root account.
    account = root
    ca_cert = /etc/grid-security/certificates/ca.cert.pem
    request_retries = 3

    [database]
    # The bootstrap job also needs the database connection string.
    default = postgresql+psycopg://{{ .Values.postgresql.auth.username }}:{{ .Values.postgresql.auth.password }}@{{ .Values.rucio.server.db_host }}/{{ .Values.postgresql.auth.database }}
{{- end }}