{{- if .Values.client.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: rucio-client-config
data:
  rucio.cfg: |
    [client]
    rucio_host = {{ required "rucio.server.host is required!" .Values.rucio.server.host }}
    auth_host = {{ required "rucio.server.host is required!" .Values.rucio.server.host }}
    auth_type = {{ .Values.client.config.auth_type }}
    account = {{ .Values.client.config.account }}
    # This path is now updated to the simpler, consistent location.
    ca_cert = /etc/grid-security/ca.pem
    client_cert = /opt/rucio/certs/user/usercert.pem
    client_key = /opt/rucio/certs/user/userkey.pem
    request_retries = 3

    [database]
    default = postgresql+psycopg://{{ .Values.postgresql.auth.username }}:{{ .Values.postgresql.auth.password }}@{{ .Values.rucio.server.db_host }}/{{ .Values.postgresql.auth.database }}
{{- end }}